(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{158:function(t,e,a){t.exports=a(358)},163:function(t,e,a){},358:function(t,e,a){"use strict";a.r(e);var n=a(0),o=a.n(n),i=a(147),r=a.n(i),s=(a(163),a(12)),c=a.n(s),l=a(28),u=a(7),d=a(8),p=a(10),h=a(9),f=a(11),b=a(19),k=a(148),m=a.n(k),v=a(151),g=a.n(v),y=a(152),S=a.n(y),C=a(153),P=a.n(C),x=a(20);function O(){var t=Object(b.a)(["\n  position: absolute;\n  width: 30px;\n  height: 30px;\n  right: 10px;\n  top: 220px;\n  padding: 5px;\n  box-shadow: 2px 2px #ddd;\n  border-radius: 2px;\n  background-color: white;\n  font-weight: bold;\n  :hover {cursor: pointer};\n"]);return O=function(){return t},t}function w(){var t=Object(b.a)(["\n  :hover {cursor: pointer};\n"]);return w=function(){return t},t}function j(){var t=Object(b.a)(["\n  display: flex;\n  width: 100%; \n  box-sizing: border-box;\n  flex-direction: column;\n  position: fixed;\n  visibility: ","\n"]);return j=function(){return t},t}var E={lat:27.9878,lng:86.925},T={fillColor:"gray",fillOpacity:.25,strokeColor:"gray",strokeOpacity:1,strokeWeight:1.5},q=m()(function(t){var e=t.position,a=t.userPosition,n=t.defaultZoom,i={center:e,options:{streetViewControl:!1,fullscreenControl:!1,mapTypeControl:!1}},r=t.places.map(function(e,a){return o.a.createElement(S.a,{key:a,position:{lat:e.lat,lng:e.lon},onClick:function(){t.openPlace(e)}})}),s=o.a.createElement(P.a,{center:a,radius:250,options:T});return o.a.createElement(g.a,Object.assign({defaultZoom:n,defaultCenter:e},i),r,t.userPosition&&s)}),L=function(t){return o.a.createElement(B,{onClick:t.onClick},t.place.name)},A=function(t){function e(t){var a;return Object(u.a)(this,e),(a=Object(p.a)(this,Object(h.a)(e).call(this,t))).state={userPosition:null},a}return Object(f.a)(e,t),Object(d.a)(e,[{key:"render",value:function(){var t=this,e=this.props.places?this.props.places.map(function(e,a){return o.a.createElement(L,{key:a,place:e,onClick:function(){return t.props.openPlace(e)}})}):"loading...";return o.a.createElement(N,{visible:this.props.visible},o.a.createElement(q,{containerElement:o.a.createElement("div",{style:{height:"100%"}}),mapElement:o.a.createElement("div",{style:{height:"400px"}}),position:this.state.userPosition?this.state.userPosition:E,userPosition:this.state.userPosition,defaultZoom:15,places:this.props.places,openPlace:this.props.openPlace}),o.a.createElement("ul",null,e),o.a.createElement(D,{src:"/images/locate.png",onClick:function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){var a={lat:e.coords.latitude,lng:e.coords.longitude};console.log("setting userPosition"),t.setState({userPosition:a})},function(){alert("couldn't get location")}):alert("browser doesn't support location")}}))}}]),e}(n.Component),N=x.a.div(j(),function(t){return t.visible?"visible":"hidden"}),B=x.a.li(w()),D=x.a.img(O()),R=a(6),_=(a(341),window.AudioContext||window.webkitAudioContext),W=Date.now(),M=function(t){function e(t){var a;return Object(u.a)(this,e),(a=Object(p.a)(this,Object(h.a)(e).call(this,t))).req=new XMLHttpRequest,a.req.open("GET",a.props.path,!0),a.req.responseType="arraybuffer",a.req.onload=function(){200===a.req.status&&(console.log("complete"),a.props.onComplete(a.req.response))},a.req.onprogress=function(t){if(t.lengthComputable){var e=t.loaded/t.total*100;a.props.onProgress(e)}},a.req.send(),a}return Object(f.a)(e,t),Object(d.a)(e,[{key:"componentWillUnmount",value:function(){this.req.onload=null,this.req.onprogress=null}},{key:"render",value:function(){return null}}]),e}(o.a.Component),J=function(t){function e(t){var a;return Object(u.a)(this,e),console.log("tracks",t.tracks),W=Date.now(),(a=Object(p.a)(this,Object(h.a)(e).call(this,t))).state={channelsOn:t.activeTracks?t.activeTracks:t.tracks.map(function(){return!0}),controlStatus:t.playbackControlStatus,avgLoaded:0,playbackPosition:0,playbackStartedAt:0},a.handlePlay=a.handlePlay.bind(Object(R.a)(a)),a.handlePause=a.handlePause.bind(Object(R.a)(a)),a.handleRewind=a.handleRewind.bind(Object(R.a)(a)),a.audioContext=new _,a.audioBuffers=t.tracks.map(function(){return null}),a.samples=t.tracks.map(function(){return null}),a.gainNodes=t.tracks.map(function(){return a.audioContext.createGain()}),a.panners=t.tracks.map(function(t,e){return"undefined"!==typeof StereoPannerNode?new StereoPannerNode(a.audioContext,{pan:0}):null}),a.loaded=t.tracks.map(function(){return 0}),a.decoded=t.tracks.map(function(){return!1}),a.calculateLoadingStatus=a.calculateLoadingStatus.bind(Object(R.a)(a)),a.loaders=a.props.tracks.map(function(t,e){return o.a.createElement(M,{key:e,path:t.file,onProgress:function(t){a._unmounted||(a.loaded[e]=t,a.calculateLoadingStatus())},onComplete:function(){var t=Object(l.a)(c.a.mark(function t(n){return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?a.audioContext.decodeAudioData(n,function(t){a._unmounted||(console.log("decoded safari"),a.audioBuffers[e]=t,a.loaded[e]=100,a.decoded[e]=!0,a.calculateLoadingStatus())}):a.audioContext.decodeAudioData(n).then(function(t){a._unmounted||(console.log("decoded"),a.audioBuffers[e]=t,a.loaded[e]=100,a.decoded[e]=!0,a.calculateLoadingStatus())});case 2:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()})}),console.log("loaders",a.loaders),a}return Object(f.a)(e,t),Object(d.a)(e,[{key:"componentDidMount",value:function(){this._unmounted=!1}},{key:"componentWillUnmount",value:function(){this.handlePause(),this._unmounted=!0}},{key:"calculateLoadingStatus",value:function(){var t=0;this.loaded.forEach(function(e){return t+=Number(e)});var e=(t/this.loaded.length).toFixed(1);this.setState({avgLoaded:e});var a=!0;this.decoded.forEach(function(t){t||(a=!1)}),e<100?this.props.updateLoadingStatus("loading... "+e+"%"):this.props.updateLoadingStatus("preparing..."),100==e&&a&&this.props.updatePlaybackControlStatus("ready")}},{key:"componentDidUpdate",value:function(){if(this.state.controlStatus!==this.props.playbackControlStatus&&(this.setState({controlStatus:this.props.playbackControlStatus}),"playing"===this.props.playbackControlStatus&&this.handlePlay(),"ready"===this.props.playbackControlStatus&&this.handleRewind(),"paused"===this.props.playbackControlStatus&&this.handlePause()),this.props.activeTracks)for(var t=0;t<this.props.activeTracks.length;t++)this.gainNodes[t]&&(this.gainNodes[t].gain.value=this.props.activeTracks[t]?1:0)}},{key:"playSample",value:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=this.audioContext.createBufferSource();n.buffer=this.audioBuffers[t],this.panners[t]?n.connect(this.gainNodes[t]).connect(this.panners[t]).connect(this.audioContext.destination):n.connect(this.gainNodes[t]).connect(this.audioContext.destination),n.start(e,a),this.samples[t]=n}},{key:"handlePlay",value:function(){var t=this;"suspended"===this.audioContext.state&&this.audioContext.resume();var e=this.audioContext.currentTime;this.setState({playbackPosition:this.state.playbackPosition,playbackStartedAt:e-this.state.playbackPosition}),console.log("starting to play at "+e),this.props.updateSequenceStartedAt&&this.props.updateSequenceStartedAt(W+1e3*(e-this.state.playbackPosition)),this.audioBuffers.forEach(function(a,n){t.playSample(n,e,t.state.playbackPosition)})}},{key:"handlePause",value:function(){this.props.updatePlaybackControlStatus("paused"),this.samples.forEach(function(t){t&&t.stop()}),this.setState({playbackPosition:this.audioContext.currentTime-this.state.playbackStartedAt})}},{key:"handleRewind",value:function(){this.samples.forEach(function(t){t&&t.stop()}),this.setState({playbackPosition:0})}},{key:"render",value:function(){var t="loading"!=this.state.controlStatus;return o.a.createElement("div",null,this.loaders,this.props.controls&&t&&o.a.createElement("button",{onClick:this.handlePlay},"Play"),this.props.controls&&t&&o.a.createElement("button",{onClick:this.handlePause},"Pause"),this.props.controls&&t&&o.a.createElement("button",{onClick:this.handleRewind},"Rewind"),this.props.controls&&o.a.createElement("span",null,"loaded: ",this.state.avgLoaded,"%"))}}]),e}(o.a.Component),U=a(54),Z=a.n(U);function z(){var t=Object(b.a)(["\n  position: absolute;\n  box-sizing: border-box;\n  width: 100%;\n  padding: 20px;\n"]);return z=function(){return t},t}function G(){var t=Object(b.a)(["\n  position: fixed;\n  top: 20px;\n  right: 20px;\n  :hover {cursor: pointer};\n"]);return G=function(){return t},t}var $=function(t){function e(t){var a;return Object(u.a)(this,e),(a=Object(p.a)(this,Object(h.a)(e).call(this,t))).state={playbackControlStatus:"loading",activeTracks:[!0,!1,!1],loadingStatus:0,tracks:null},a.updatePlaybackControlStatus=a.updatePlaybackControlStatus.bind(Object(R.a)(a)),a.toggleTrack=a.toggleTrack.bind(Object(R.a)(a)),a}return Object(f.a)(e,t),Object(d.a)(e,[{key:"componentDidMount",value:function(){var t=Object(l.a)(c.a.mark(function t(){var e,a;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Z.a.get("/api/place/"+this.props.place._id,{params:{$embed:JSON.stringify(["audio1","audio2","audio3"])}});case 2:e=t.sent,console.log(e),a=[{file:e.data.audio1.url},{file:e.data.audio2.url},{file:e.data.audio3.url}],console.log(a),this.setState({place:e.data,tracks:a});case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"updatePlaybackControlStatus",value:function(t){this.setState({playbackControlStatus:t})}},{key:"toggleTrack",value:function(t){var e=[!1,!1,!1];e[t]=!0,this.setState({activeTracks:e})}},{key:"render",value:function(){var t=this,e=this.state.activeTracks.map(function(e,a){return o.a.createElement("button",{onClick:function(){t.toggleTrack(a)}},"Channel ",a+1,": ",e?"on":"off")});return o.a.createElement("div",null,o.a.createElement(H,null,o.a.createElement("div",null,"place page: ",this.state.place?this.state.place.name:"loading..."),this.state.tracks&&o.a.createElement(J,{playbackControlStatus:this.state.playbackControlStatus,updatePlaybackControlStatus:this.updatePlaybackControlStatus,updateLoadingStatus:function(e){return t.setState({loadingStatus:e})},tracks:this.state.tracks,activeTracks:this.state.activeTracks,controls:!0}),"loading"!=this.state.playbackControlStatus&&e),o.a.createElement(F,{onClick:this.props.exitPlace},"\u274e leave"))}}]),e}(n.Component),F=x.a.div(G()),H=x.a.div(z()),I=function(t){function e(t){var a;return Object(u.a)(this,e),(a=Object(p.a)(this,Object(h.a)(e).call(this,t))).state={places:[],currentPlace:null},a}return Object(f.a)(e,t),Object(d.a)(e,[{key:"componentDidMount",value:function(){var t=Object(l.a)(c.a.mark(function t(){var e;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Z.a.get("/api/place");case 2:e=t.sent,this.setState({places:e.data.docs});case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this;return o.a.createElement("div",null,o.a.createElement(A,{visible:!this.state.currentPlace,places:this.state.places,openPlace:function(e){t.setState({currentPlace:e})}}),this.state.currentPlace&&o.a.createElement($,{place:this.state.currentPlace,exitPlace:function(){t.setState({currentPlace:null})}}))}}]),e}(n.Component),V=function(){return o.a.createElement(I,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(V,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[158,1,2]]]);
//# sourceMappingURL=main.5c9d9544.chunk.js.map